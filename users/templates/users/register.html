{% extends "main/base.html" %}
{% load widget_tweaks %}

{% block title %}Registar{% endblock %}

{% block content %}
<div class="container my-4">
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
      <div class="card shadow p-4 neon-box">
        <h4 class="mb-4 text-center text-success">
          <i class="fas fa-user-plus"></i> Criar Conta
        </h4>

        <form method="post" novalidate>
          {% csrf_token %}

          <!-- Username -->
          <div class="d-flex align-items-center mb-3 gap-2">
            <label class="form-label mb-0 min-w-150">
              <i class="fas fa-user text-primary"></i> Utilizador
            </label>
            {{ form.username|add_class:"form-control form-control-sm flex-grow-1" }}
          </div>
          {% for error in form.username.errors %}
            <div class="text-danger small mb-2">{{ error }}</div>
          {% endfor %}

          <!-- Nome e Sobrenome -->
          <div class="d-flex flex-wrap gap-2 mb-3">
            <div class="d-flex align-items-center flex-grow-1 gap-2">
              <label class="form-label mb-0 min-w-150">
                <i class="fas fa-id-card text-primary"></i> Nome
              </label>
              {{ form.first_name|add_class:"form-control form-control-sm flex-grow-1" }}
            </div>
            <div class="d-flex align-items-center flex-grow-1 gap-2">
              <label class="form-label mb-0 min-w-150">
                <i class="fas fa-id-card-alt text-primary"></i> Sobrenome
              </label>
              {{ form.last_name|add_class:"form-control form-control-sm flex-grow-1" }}
            </div>
          </div>
          {% for error in form.first_name.errors %}
            <div class="text-danger small mb-2">{{ error }}</div>
          {% endfor %}
          {% for error in form.last_name.errors %}
            <div class="text-danger small mb-2">{{ error }}</div>
          {% endfor %}

          <!-- Email -->
          <div class="d-flex align-items-center mb-3 gap-2">
            <label class="form-label mb-0 min-w-150">
              <i class="fas fa-envelope text-info"></i> Email
            </label>
            {{ form.email|add_class:"form-control form-control-sm flex-grow-1" }}
          </div>
          {% for error in form.email.errors %}
            <div class="text-danger small mb-2">{{ error }}</div>
          {% endfor %}

          <!-- Categoria -->
          <div class="d-flex align-items-center mb-3 gap-2">
            <label class="form-label mb-0 min-w-150">
              <i class="fas fa-users text-success"></i> Categoria
            </label>
            {{ form.categoria|add_class:"form-select form-select-sm flex-grow-1" }}
          </div>
          {% for error in form.categoria.errors %}
            <div class="text-danger small mb-2">{{ error }}</div>
          {% endfor %}

          <!-- Grau Académico -->
          <div class="d-flex align-items-center mb-3 gap-2">
            <label class="form-label mb-0 min-w-150">
              <i class="fas fa-graduation-cap text-warning"></i> Grau Académico
            </label>
            {{ form.grau_academico|add_class:"form-select form-select-sm flex-grow-1" }}
          </div>
          {% for error in form.grau_academico.errors %}
            <div class="text-danger small mb-2">{{ error }}</div>
          {% endfor %}

         <!-- Especialidade: só renderiza se categoria for professor -->
                {% if form.categoria.value == "professor" %}
                <div id="especialidade-field" class="d-flex align-items-center mb-3 gap-2">
                    <label class="form-label mb-0 min-w-150">
                    <i class="fas fa-briefcase text-danger"></i> Especialidade
                    </label>
                    {{ form.especialidade|add_class:"form-control form-control-sm flex-grow-1" }}
                </div>
                {% for error in form.especialidade.errors %}
                    <div class="text-danger small mb-2">{{ error }}</div>
                {% endfor %}
                {% endif %}


          <!-- Senhas lado a lado -->
          <div class="d-flex flex-wrap gap-2 mb-4">
            <div class="d-flex align-items-center flex-grow-1 gap-2">
              <label class="form-label mb-0 min-w-150">
                <i class="fas fa-lock text-secondary"></i> Palavra-passe
              </label>
              {{ form.password1|add_class:"form-control form-control-sm flex-grow-1" }}
            </div>
            <div class="d-flex align-items-center flex-grow-1 gap-2">
              <label class="form-label mb-0 min-w-150">
                <i class="fas fa-lock text-secondary"></i> Confirmar
              </label>
              {{ form.password2|add_class:"form-control form-control-sm flex-grow-1" }}
            </div>
          </div>
          {% for error in form.password1.errors %}
            <div class="text-danger small mb-2">{{ error }}</div>
          {% endfor %}
          {% for error in form.password2.errors %}
            <div class="text-danger small mb-2">{{ error }}</div>
          {% endfor %}

          <!-- Botão -->
          <button type="submit" class="btn btn-success w-100">
            <i class="fas fa-user-plus"></i> Registar
          </button>

          <p class="mt-3 text-center">Já tem conta? <a href="{% url 'login' %}">Entrar</a></p>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const categoria = document.getElementById('id_categoria');
  const form = categoria.closest('form');

  function toggleEspecialidade() {
    const valor = (categoria.value || '').toLowerCase().trim();
    let field = document.getElementById('especialidade-field');

    if (valor === 'professor') {
      // Se ainda não existe, cria o bloco
      if (!field) {
        const wrapper = document.createElement('div');
        wrapper.id = 'especialidade-field';
        wrapper.className = 'd-flex align-items-center mb-3 gap-2';

        wrapper.innerHTML = `
          <label class="form-label mb-0 min-w-150">
            <i class="fas fa-briefcase text-danger"></i> Especialidade
          </label>
          <input type="text" name="especialidade" id="id_especialidade"
            class="form-control form-control-sm flex-grow-1"
            placeholder="Sua especialidade">
        `;
        // Insere antes do bloco de senhas
        const senhaBlock = document.querySelector('.d-flex.flex-wrap.gap-2.mb-4');
        form.insertBefore(wrapper, senhaBlock);
      }
    } else {
      // Remove se existir
      if (field) {
        field.remove();
      }
    }
  }

  categoria.addEventListener('change', toggleEspecialidade);
  toggleEspecialidade(); // ao carregar
});
</script>


<style>
.min-w-150 { min-width: 150px; }
.neon-box {
  border-radius: 15px;
  overflow: hidden;
  position: relative;
}
.neon-box::before,
.neon-box::after {
  content: '';
  position: absolute;
  top: -5px; left: -5px; right: -5px; bottom: -5px;
  background: conic-gradient(from 0deg, #00f7ff, #ff00ff, #00f7ff, #ff00ff);
  animation: rotateNeon 4s linear infinite;
  filter: blur(10px);
  z-index: -1;
  opacity: 0.6;
  border-radius: 20px;
}
.neon-box::after { animation-direction: reverse; }
@keyframes rotateNeon {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
{% endblock %}
