<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Plataforma Fluent Bridge English{% endblock %}</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- AOS Animation CSS -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f8f9fa;
        }
        footer {
            background-color: #212529;
            color: #fff;
            padding: 1.5rem;
        }
        html, body {
            overflow-x: hidden;
            width: 100%;
        }
        .navbar .dropdown-menu {
        border-radius: 10px;
        animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-5px); }
        to { opacity: 1; transform: translateY(0); }
        }

        body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f8f9fa;
    }

    main {
      flex: 1; /* empurra o footer para o fim quando necess√°rio */
    }

#botaoContato {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: linear-gradient(45deg, #007bff, #00c4ff);
  color: white;
  padding: 15px 17px;
  border-radius: 50%;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  z-index: 1050;
  cursor: grab;
  transition: transform 0.3s ease;
  font-size: 20px;
}
#botaoContato:hover {
  transform: scale(1.1);
  background: linear-gradient(45deg, #0056b3, #008ecc);
}
    </style> 


</head>

<body class="d-flex flex-column min-vh-100">
   <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'home' %}">FBE Online</a>
    <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
  
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto align-items-center">

        {% if user.is_authenticated %}
         <!-- Mensagens -->
          <li class="nav-item position-relative">
            <a href="{% url 'mensagens_lista' %}" class="nav-link">
              <i class="fas fa-comments"></i>
              <span class="d-none d-lg-inline">Mensagens</span>
              {% if total_mensagens_nao_lidas > 0 %}
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                  {{ total_mensagens_nao_lidas }}
                </span>
              {% endif %}
            </a>
          </li>

<!-- Notifica√ß√µes -->      
<li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle position-relative" href="#" role="button" data-bs-toggle="dropdown">
    <i class="fas fa-bell"></i>
    <span class="d-none d-lg-inline">Notifica√ß√µes</span>
    {% if total_notificacoes > 0 %}
      <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
        {{ total_notificacoes }}
      </span>
    {% endif %}
  </a>
  <ul class="dropdown-menu dropdown-menu-end shadow-sm">
    {% if user.notificacoes.exists %}
      {% for n in user.notificacoes.all|slice:":5" %}
        <li>
          <a class="dropdown-item d-flex justify-content-between align-items-start {% if not n.lida %}fw-bold{% endif %}"
             href="{% url 'marcar_lida' n.id %}">
            {{ n.mensagem|truncatechars:55 }}
            {% if not n.lida %}
              <span class="badge bg-success ms-2">Novo</span>
            {% endif %}
          </a>
        </li>
      {% endfor %}
      <li><hr class="dropdown-divider"></li>
      <li>
        <a class="dropdown-item text-center text-primary" href="{% url 'notificacoes' %}">
          Ver todas notifica√ß√µes
        </a>
      </li>
    {% else %}
      <li><span class="dropdown-item text-muted">Sem notifica√ß√µes</span></li>
    {% endif %}
  </ul>
</li>

          <!-- Dropdown de Perfil -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
              {% if user.foto_perfil %}
                <img src="{{ user.foto_perfil.url }}" alt="Avatar" class="rounded-circle me-1" width="30" height="30">
              {% else %}
                <i class="fas fa-user-circle fa-lg me-1"></i>
              {% endif %}
              {{ user.get_full_name|default:user.username }}
            </a>
            <ul class="dropdown-menu dropdown-menu-end shadow">
              <li><a class="dropdown-item" href="{% url 'meu_perfil' %}">üë§ Meu Perfil</a></li>
              {% if user.categoria == 'estudante' %}
                <li><a class="dropdown-item" href="{% url 'painel_aluno' %}">üéì Painel do Aluno</a></li>
              {% elif user.categoria == 'professor' %}
                <li><a class="dropdown-item" href="{% url 'painel_salas_professor' %}">üìö Painel do Professor</a></li>
              {% endif %}
              <li><a class="dropdown-item" href="{% url 'painel_colegas' %}">üîç Pesquisar Usu√°rios</a></li>
                  {% if user.tipo_acesso == 'admin' or user.is_admin or user.is_superuser %}
                  <li><a class="dropdown-item" href="{% url 'painel_admin_home' %}">‚öôÔ∏è Painel Admin</a></li>
                   {% endif %}
                   
                 

              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" href="{% url 'logout' %}">üö™ Sair</a></li>
            </ul>
          </li>
        
        {% else %}
          <!-- Se n√£o logado -->
          <li class="nav-item">
            <a href="{% url 'register' %}" class="nav-link">
              <i class="fas fa-user-plus"></i> Registar
            </a>
          </li>
        {% endif %}

      </ul>
    </div>
  </div>
</nav>
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
    <!-- Conte√∫do principal -->
    <main class="flex-grow-1">
        {% block content %}
        {% endblock %}
    </main>

    
    <!-- Rodap√© -->
    <footer class="text-center mt-auto">
        <p>&copy; 2025 Plataforma FLUENT BRIDGE ENGLISH - Desenvolvido POR Lu¬¥s e imagem</p>
    </footer>

    <!-- Scripts JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
  
    <script>
        AOS.init(); // ativa anima√ß√µes


document.addEventListener("DOMContentLoaded", function () {
  const btn = document.getElementById("botaoContato");

  // Ao clicar, abrir modal
  btn.addEventListener("click", () => {
    new bootstrap.Modal(document.getElementById("modalContato")).show();
  });

  // Tornar o bot√£o arrast√°vel
  let isDragging = false;
  let offset = { x: 0, y: 0 };

  btn.addEventListener("mousedown", (e) => {
    isDragging = true;
    offset.x = btn.offsetLeft - e.clientX;
    offset.y = btn.offsetTop - e.clientY;
    btn.style.cursor = "grabbing";
  });

  document.addEventListener("mouseup", () => {
    isDragging = false;
    btn.style.cursor = "grab";
  });

  document.addEventListener("mousemove", (e) => {
    if (isDragging) {
      btn.style.left = `${e.clientX + offset.x}px`;
      btn.style.top = `${e.clientY + offset.y}px`;
    }
  });
});


    </script>

<script src="http://localhost:35729/livereload.js?snipver=1"></script>


<!-- üîò BOT√ÉO FLUTUANTE -->
<div id="botaoContato" title="Fale com o admin">
  <i class="fas fa-comment-dots"></i>
</div>

<!-- üì® MODAL DE CONTATO -->
<div class="modal fade" id="modalContato" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{% url 'contato' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-envelope"></i> Enviar Reclama√ß√£o / Mensagem</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <label>Nome</label>
            <input type="text" name="nome" value="{{ request.user.get_full_name|default:request.user.username }}" class="form-control" required>
          </div>
          <div class="mb-2">
            <label>Email</label>
            <input type="email" name="email" value="{{ request.user.email }}" class="form-control" required>
          </div>
          <div class="mb-2">
            <label>Assunto</label>
            <input type="text" name="assunto" class="form-control" required>
          </div>
          <div class="mb-2">
            <label>Mensagem</label>
            <textarea name="mensagem" class="form-control" rows="4" required></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary"><i class="fas fa-paper-plane"></i> Enviar</button>
        </div>
      </form>
    </div>
  </div>
</div>


</body>
</html>